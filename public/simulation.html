<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css" />
    <style>
      #video-container {
        position: relative;
        width: 960px;
        height: 720px;
        margin: 20px auto;
      }

      #video {
        position: absolute;
        top: 0;
        left: 0;
        transform: scaleX(-1);
      }

      #canvas {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
      }

      #prediction {
        text-align: center;
        font-size: 24px;
        margin-top: 20px;
      }
    </style>
    <title>Sign Smart Watch - Simulation</title>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/fingerpose@0.1.0/dist/fingerpose.min.js"></script>
  </head>

  <body>
    <header>
      <nav>
        <a href="index.html">Home</a>
        <div class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
        <div class="nav-links">
          <a href="speller.html">Speller</a>
          <a href="translator.html">Translator</a>
          <a href="simulation.html">Simulation</a>
          <a href="health.html">Health Monitor</a>
          <a href="learning.html">Learning</a>
          <a href="cheerup.html">Cheer Up</a>
          <a href="login.html">Login</a>
        </div>
      </nav>
    </header>
    <section class="main">
      <h1 class="title">Real-Time Simulation</h1>

      <div id="video-container">
        <video id="video" width="960" height="720" autoplay playsinline></video>
        <canvas id="canvas" width="960" height="720"></canvas>
      </div>

      <div id="prediction">Loading...</div>
    </section>

    <footer
      style="
        background: var(--text-primary);
        color: var(--white);
        padding: var(--space-2xl) var(--space-lg);
        text-align: center;
      "
    >
      <div style="max-width: 1200px; margin: 0 auto">
        <p
          style="
            margin-bottom: var(--space-sm);
            color: var(--white);
            opacity: 0.9;
          "
        >
          &copy; 2026 ICIC Sign Smart Watch. Empowering communication and health
          monitoring.
        </p>
        <p style="font-size: 0.9rem; color: var(--white); opacity: 0.7">
          Making sign language accessible to everyone, everywhere.
        </p>
      </div>
    </footer>

    <script src="js/auth-check.js"></script>
    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const predictionText = document.getElementById("prediction");

      let lastSpeech = 0;
      let lastPoints = [];

      
      function smooth(points) {
        if (lastPoints.length === 0) {
          lastPoints = points;
          return points;
        }

        const smoothed = points.map((p, i) => ({
          x: p.x * 0.7 + lastPoints[i].x * 0.3,
          y: p.y * 0.7 + lastPoints[i].y * 0.3,
        }));

        lastPoints = smoothed;
        return smoothed;
      }

      /* =========================
   CAMERA (720p high quality)
========================= */
      async function setupCamera() {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: 1280,
            height: 720,
          },
        });

        video.srcObject = stream;

        return new Promise((res) => {
          video.onloadedmetadata = () => res();
        });
      }

      const thumbsUp = new fp.GestureDescription("ThumbsUp");
      thumbsUp.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
      ].forEach((f) => thumbsUp.addCurl(f, fp.FingerCurl.FullCurl, 1.0));

      const openPalm = new fp.GestureDescription("Space");
      [
        fp.Finger.Thumb,
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
      ].forEach((f) => openPalm.addCurl(f, fp.FingerCurl.NoCurl, 1.0));

      // Letter A
      const letterA = new fp.GestureDescription("A");
      letterA.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterA.addDirection(fp.Finger.Thumb, fp.FingerDirection.VerticalUp, 1.0);
      letterA.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.DiagonalUpLeft,
        0.9,
      );
      letterA.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.DiagonalUpRight,
        0.9,
      );
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
      ]) {
        letterA.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
        letterA.addDirection(finger, fp.FingerDirection.VerticalDown, 1.0);
      }

      // Letter B
      const letterB = new fp.GestureDescription("B");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
      ]) {
        letterB.addCurl(finger, fp.FingerCurl.NoCurl, 1.0);
        letterB.addDirection(finger, fp.FingerDirection.VerticalUp, 1.0);
      }
      letterB.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterB.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterB.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );

      // Letter C
      const letterC = new fp.GestureDescription("C");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
        fp.Finger.Thumb,
      ]) {
        letterC.addCurl(finger, fp.FingerCurl.HalfCurl, 1.0);
        letterC.addDirection(finger, fp.FingerDirection.DiagonalUpLeft, 1.0);
        letterC.addDirection(finger, fp.FingerDirection.DiagonalUpRight, 1.0);
      }

      // Letter D
      const letterD = new fp.GestureDescription("D");
      letterD.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterD.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [fp.Finger.Middle, fp.Finger.Ring, fp.Finger.Pinky]) {
        letterD.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
        letterD.addDirection(finger, fp.FingerDirection.VerticalDown, 1.0);
      }
      letterD.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);

      // Letter E
      const letterE = new fp.GestureDescription("E");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
        fp.Finger.Thumb,
      ]) {
        letterE.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
        letterE.addDirection(finger, fp.FingerDirection.VerticalDown, 1.0);
      }

      // Letter F
      const letterF = new fp.GestureDescription("F");
      letterF.addCurl(fp.Finger.Index, fp.FingerCurl.HalfCurl, 1.0);
      letterF.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      for (let finger of [fp.Finger.Middle, fp.Finger.Ring, fp.Finger.Pinky]) {
        letterF.addCurl(finger, fp.FingerCurl.NoCurl, 1.0);
        letterF.addDirection(finger, fp.FingerDirection.VerticalUp, 1.0);
      }

      // Letter G
      const letterG = new fp.GestureDescription("G");
      letterG.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterG.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterG.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      letterG.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterG.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterG.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      for (let finger of [fp.Finger.Middle, fp.Finger.Ring, fp.Finger.Pinky]) {
        letterG.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter H
      const letterH = new fp.GestureDescription("H");
      letterH.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterH.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterH.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterH.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterH.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      letterH.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky, fp.Finger.Thumb]) {
        letterH.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter I
      const letterI = new fp.GestureDescription("I");
      letterI.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);
      letterI.addDirection(fp.Finger.Pinky, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Thumb,
      ]) {
        letterI.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter J (requires motion, so we'll use 'I' as a base)
      const letterJ = new fp.GestureDescription("J");
      letterJ.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);
      letterJ.addDirection(fp.Finger.Pinky, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Thumb,
      ]) {
        letterJ.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter K
      const letterK = new fp.GestureDescription("K");
      letterK.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterK.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterK.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterK.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.DiagonalUpLeft,
        0.9,
      );
      letterK.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.DiagonalUpRight,
        0.9,
      );
      letterK.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterK.addDirection(fp.Finger.Thumb, fp.FingerDirection.VerticalUp, 0.8);
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky]) {
        letterK.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter L
      const letterL = new fp.GestureDescription("L");
      letterL.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterL.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterL.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterL.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterL.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      for (let finger of [fp.Finger.Middle, fp.Finger.Ring, fp.Finger.Pinky]) {
        letterL.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter M
      const letterM = new fp.GestureDescription("M");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Thumb,
      ]) {
        letterM.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }
      letterM.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);

      // Letter N
      const letterN = new fp.GestureDescription("N");
      for (let finger of [fp.Finger.Index, fp.Finger.Middle, fp.Finger.Thumb]) {
        letterN.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky]) {
        letterN.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter O
      const letterO = new fp.GestureDescription("O");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
      ]) {
        letterO.addCurl(finger, fp.FingerCurl.HalfCurl, 1.0);
      }
      letterO.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 0.9);

      // Letter P
      const letterP = new fp.GestureDescription("P");
      letterP.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterP.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterP.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      letterP.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterP.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.VerticalDown,
        1.0,
      );
      letterP.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky]) {
        letterP.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter Q
      const letterQ = new fp.GestureDescription("Q");
      letterQ.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterQ.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.DiagonalDownLeft,
        1.0,
      );
      letterQ.addDirection(
        fp.Finger.Index,
        fp.FingerDirection.DiagonalDownRight,
        1.0,
      );
      letterQ.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      for (let finger of [fp.Finger.Middle, fp.Finger.Ring, fp.Finger.Pinky]) {
        letterQ.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter R
      const letterR = new fp.GestureDescription("R");
      letterR.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterR.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterR.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterR.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.VerticalUp,
        1.0,
      );
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky, fp.Finger.Thumb]) {
        letterR.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter S
      const letterS = new fp.GestureDescription("S");
      for (let finger of [
        fp.Finger.Index,
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
        fp.Finger.Thumb,
      ]) {
        letterS.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter T
      const letterT = new fp.GestureDescription("T");
      letterT.addCurl(fp.Finger.Index, fp.FingerCurl.FullCurl, 1.0);
      letterT.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);
      letterT.addCurl(fp.Finger.Thumb, fp.FingerCurl.HalfCurl, 1.0);
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky]) {
        letterT.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter U
      const letterU = new fp.GestureDescription("U");
      letterU.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterU.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterU.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterU.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.VerticalUp,
        1.0,
      );
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky, fp.Finger.Thumb]) {
        letterU.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter V
      const letterV = new fp.GestureDescription("V");
      letterV.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterV.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterV.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterV.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.VerticalUp,
        1.0,
      );
      for (let finger of [fp.Finger.Ring, fp.Finger.Pinky, fp.Finger.Thumb]) {
        letterV.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter W
      const letterW = new fp.GestureDescription("W");
      letterW.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterW.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
      letterW.addCurl(fp.Finger.Ring, fp.FingerCurl.NoCurl, 1.0);
      letterW.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      letterW.addDirection(
        fp.Finger.Middle,
        fp.FingerDirection.VerticalUp,
        1.0,
      );
      letterW.addDirection(fp.Finger.Ring, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [fp.Finger.Pinky, fp.Finger.Thumb]) {
        letterW.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter X
      const letterX = new fp.GestureDescription("X");
      letterX.addCurl(fp.Finger.Index, fp.FingerCurl.HalfCurl, 1.0);
      for (let finger of [
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
        fp.Finger.Thumb,
      ]) {
        letterX.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter Y
      const letterY = new fp.GestureDescription("Y");
      letterY.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
      letterY.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);
      letterY.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalLeft,
        1.0,
      );
      letterY.addDirection(
        fp.Finger.Thumb,
        fp.FingerDirection.HorizontalRight,
        1.0,
      );
      letterY.addDirection(fp.Finger.Pinky, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [fp.Finger.Index, fp.Finger.Middle, fp.Finger.Ring]) {
        letterY.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      // Letter Z (requires motion, so we'll use 'V' as a base)
      const letterZ = new fp.GestureDescription("Z");
      letterZ.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
      letterZ.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
      for (let finger of [
        fp.Finger.Middle,
        fp.Finger.Ring,
        fp.Finger.Pinky,
        fp.Finger.Thumb,
      ]) {
        letterZ.addCurl(finger, fp.FingerCurl.FullCurl, 1.0);
      }

      const knownGestures = [
        thumbsUp,
        openPalm,
        letterA,
        letterB,
        letterC,
        letterD,
        letterE,
        letterF,
        letterG,
        letterH,
        letterI,
        letterJ,
        letterK,
        letterL,
        letterM,
        letterN,
        letterO,
        letterP,
        letterQ,
        letterR,
        letterS,
        letterT,
        letterU,
        letterV,
        letterW,
        letterX,
        letterY,
        letterZ,
      ];
      const GE = new fp.GestureEstimator(knownGestures);

      /* =========================
   MAIN
========================= */

      async function main() {
        await setupCamera();

        await tf.setBackend("webgl");

        const model = handPoseDetection.SupportedModels.MediaPipeHands;

        const detector = await handPoseDetection.createDetector(model, {
          runtime: "tfjs",
          modelType: "full",
          maxHands: 2,
        });

        predictionText.innerText = "Ready!";

        setInterval(async () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          const hands = await detector.estimateHands(video, {
            flipHorizontal: true,
          });

          let sentence = "";

          for (const hand of hands) {
            const pts = smooth(hand.keypoints);

            /* draw */
            pts.forEach((p) => {
              ctx.beginPath();
              ctx.arc(p.x, p.y, 6, 0, 2 * Math.PI);
              ctx.fillStyle = "#00ff00";
              ctx.fill();
            });

            /* fingerpose */
            const landmarks = pts.map((p) => [p.x, p.y, p.z || 0]);

            const est = GE.estimate(landmarks, 7.5);

            if (est.gestures.length > 0) {
              const best = est.gestures.reduce((a, b) =>
                a.score > b.score ? a : b,
              );
              sentence += best.name + " ";
            }
          }

          if (sentence !== "") {
            predictionText.innerText = sentence;

            const now = Date.now();
            if (now - lastSpeech > 2000) {
              const speakText = sentence.replace("Space", "");
              if (speakText.trim()) {
                speechSynthesis.speak(new SpeechSynthesisUtterance(speakText));
                lastSpeech = now;
              }
            }
          }
        }, 40);
      }

      main();
    </script>
  </body>
</html>
